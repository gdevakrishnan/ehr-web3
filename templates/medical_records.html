{% extends 'layout.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block title %}
Medical Records
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .header {
        margin-top: 80px;
        text-align: center;
    }

    .record-container {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
    }

    .record-card {
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 350px;
        padding: 20px;
        transition: transform 0.2s ease-in-out;
    }

    .record-card:hover {
        transform: translateY(-5px);
    }

    .record-header {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        color: #198754;
    }

    .record-field {
        margin-bottom: 8px;
    }

    .field-label {
        font-weight: 600;
        color: #343a40;
    }

    .field-value {
        color: #495057;
    }

    .no-records {
        text-align: center;
        margin-top: 100px;
        font-size: 20px;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block nav %}
<div class="collapse navbar-collapse justify-content-end" id="navbarNav">
    <ul class="navbar-nav">
        {% if user_data.user_type == 'patient' %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('dashboard') }}">Home</a>
        </li>
        {% else %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('user_dashboard') }}">Home</a>
        </li>
        {% endif %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('records') }}">Records</a>
        </li>
        {% if user_data.user_type == 'patient' %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('add_doctor') }}">Doctor</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('add_audit') }}">Audit</a>
        </li>
        {% endif %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('profile') }}">
                {{ user_data.wallet_address[:8] }}...{{ user_data.wallet_address[-6:] }}
            </a>
        </li>
    </ul>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <h2>Medical Records</h2>
    </div>

    {% if data and data|length > 0 %}
    <div class="record-container">
        {% for record in data %}
        <div class="record-card">
            <div class="record-header">Visit ID: {{ record.unique_id }}</div>
            <div class="record-field">
                <span class="field-label">Patient Contract:</span>
                <span class="field-value">{{ record.contract_address[:8] }}.....{{ record.contract_address[-6:]
                    }}</span>
            </div>
            <div class="record-field">
                <span class="field-label">Message:</span>
                <span class="field-value">{{ record.record_msg }}</span>
            </div>
            <div class="record-field">
                <span class="field-label">Details:</span>
                <span class="field-value">{{ record.record_details }}</span>
            </div>
            <div class="record-field">
                <span class="field-label">Doctor Address:</span>
                <span class="field-value">
                    {% if record.doctor_address %}
                    {{ record.doctor_address[:8] }}.....{{ record.doctor_address[-6:] }}
                    {% else %}
                    N/A
                    {% endif %}
                </span>
            </div>
            <div class="record-field">
                <span class="field-label">Audit Address:</span>
                <span class="field-value">
                    {% if record.audit_address %}
                    {{ record.audit_address[:8] }}.....{{ record.audit_address[-6:] }}
                    {% else %}
                    N/A
                    {% endif %}
                </span>
            </div>
            <div class="record-field">
                <span class="field-label">Created At:</span>
                <span class="field-value">{{ record.created_at.split('T')[0] }} / {{
                    record.created_at.split('T')[1][0:5] }}</span>
            </div>
            <div class="actions">
                <a href="{{ url_for('view_record', unique_id=record.unique_id) }}">view</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-records">No medical records found.</div>
    {% endif %}
</div>
{% endblock %}
{% extends 'layout.html' %}

{% block title %}
Staff Dashboard
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .container {
        margin-top: 80px;
    }
    .dashboard-header {
        margin-bottom: 30px;
        text-align: center;
    }
    .user-info-card {
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .user-info-heading {
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    .info-label {
        font-weight: 600;
        color: #555;
    }
    .info-value {
        margin-bottom: 15px;
    }
    .card-header {
        background-color: #f1f1f1;
        padding: 10px 15px;
        border-bottom: 1px solid #ddd;
        font-weight: bold;
    }
    .role-badge {
        padding: 5px 10px;
        border-radius: 3px;
        color: white;
        font-size: 0.9em;
        display: inline-block;
        margin-left: 10px;
    }
    .role-doctor {
        background-color: #28a745;
    }
    .role-audit {
        background-color: #007bff;
    }
    .action-button {
        margin-top: 20px;
        width: 100%;
    }
    .contract-section {
        margin-top: 30px;
    }
    .address-box {
        font-family: monospace;
        background-color: #f1f1f1;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block nav %}
<div class="collapse navbar-collapse justify-content-end" id="navbarNav">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('dashboard') }}">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('records') }}">Records</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('profile') }}">
                {{ patient_data.wallet_address[:8] }}...{{ patient_data.wallet_address[-6:] }}
            </a>
        </li>
    </ul>
</div>
{% endblock %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="dashboard-header">
        <h2>Staff Dashboard</h2>
        <h4>
            {{ user_data.first_name }} {{ user_data.last_name }}
            {% if user_data.user_type == 'doctor' %}
                <span class="role-badge role-doctor">Doctor</span>
            {% elif user_data.user_type == 'audit' %}
                <span class="role-badge role-audit">Auditor</span>
            {% endif %}
        </h4>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="user-info-card">
                <div class="card-header">Personal Information</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 info-label">Name:</div>
                        <div class="col-md-8 info-value">{{ user_data.first_name }} {{ user_data.last_name }}</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 info-label">Employee ID:</div>
                        <div class="col-md-8 info-value">{{ user_data.employee_id }}</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 info-label">Email:</div>
                        <div class="col-md-8 info-value">{{ user_data.email }}</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 info-label">Role:</div>
                        <div class="col-md-8 info-value">
                            {% if user_data.user_type == 'doctor' %}
                                Doctor
                            {% elif user_data.user_type == 'audit' %}
                                Auditor
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 info-label">Created:</div>
                        <div class="col-md-8 info-value">{{ user_data.created_at }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="user-info-card">
                <div class="card-header">Blockchain Information</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 info-label">Account Address:</div>
                        <div class="col-md-8 info-value">
                            <div class="address-box">{{ user_data.account_address }}</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 info-label">Patient Contract:</div>
                        <div class="col-md-8 info-value">
                            <div class="address-box">{{ user_data.patient_contract }}</div>
                        </div>
                    </div>
                    
                    {% if user_data.tx_hash %}
                    <div class="row">
                        <div class="col-md-4 info-label">Transaction Hash:</div>
                        <div class="col-md-8 info-value">
                            <div class="address-box">{{ user_data.tx_hash }}</div>
                            <a href="https://sepolia.etherscan.io/tx/{{ user_data.tx_hash }}" target="_blank" class="btn btn-sm btn-info mt-2">View on Etherscan</a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row contract-section">
        <div class="col-md-12">
            <div class="user-info-card">
                <div class="card-header">Actions</div>
                <div class="card-body text-center">
                    {% if user_data.user_type == 'doctor' %}
                        <a href="#" class="btn btn-primary action-button">Access Patient Medical Records</a>
                    {% elif user_data.user_type == 'audit' %}
                        <a href="#" class="btn btn-info action-button">View Audit Trail</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}